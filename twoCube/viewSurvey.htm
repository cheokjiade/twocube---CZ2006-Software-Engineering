<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css"
        rel="stylesheet" type="text/css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
    <script language="javascript" type="text/javascript" src="Scripts/jquery.jqplot.min.js"></script>
    <script type="text/javascript" src="Scripts/plugins/jqplot.pieRenderer.js"></script>
    <script type="text/javascript" src="Scripts/plugins/jqplot.barRenderer.js"></script>
    <script type="text/javascript" src="Scripts/plugins/jqplot.categoryAxisRenderer.js"></script>
    <script type="text/javascript" src="Scripts/plugins/jqplot.categoryAxisRenderer.js"></script>
    <script type="text/javascript" src="../src/plugins/jqplot.donutRenderer.min.js"></script>
    <link rel="Stylesheet" type="text/css" href="Styles/jquery.jqplot.min.css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="css/ddsmoothmenu.css" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/ddsmoothmenu.js"></script>
    <script type="text/javascript">
        $.urlParam = function (name) {
            var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
            return results[1] || 0;
        }
        function onload() {
            loadMenu();
            loadFooter();
            if ($.urlParam('s') != 0) window.location = "./dosurvey.html?s=" + $.urlParam('s');
        }
        function loadMenu() {
            var data = localStorage.getItem("twocubeSSO") || 0;


            var menu = "<ul>\
                <li><a href='index.html'>Home</a></li>\
                <li><a href='index.html'>Create Survey</a></li>\
                <li><a href='#'>About twoCube</a></li>\
				<li><a href='./Login.htm'>Login</a></li>\
            </ul>\
            <br style='clear: left' />";

            var loginedmenu = "<ul>\
                <li><a href='index.html'>Home</a></li>\
                <li><a href='index.html'>Create Survey</a></li>\
                <li><a href='#'>About twoCube</a></li>\
                <li><a href='#'>View Created Surveys</a></li>\
				<li><a href='#' onclick='logout();'>Logout</a></li>\
            </ul>\
            <br style='clear: left' />";

            if (data == 0)
                document.getElementById('menu').innerHTML = menu;
            else
                document.getElementById('menu').innerHTML = loginedmenu;
        }
        function loadFooter() {
            document.getElementById('footer').innerHTML = "Copyright © 2013 twoCube<div class='cleaner'></div>";
        }
        function logout() {
            localStorage.clear();
            window.location = "./Default.aspx";
        }
    </script>  
</head>
<body onload="onload()">
    <div id="wrapper">
	<div id="header">
        <div id="site_title"><h1><a href="#"></a></h1></div>
        <div id="menu" class="ddsmoothmenu">
        </div> <!-- end of menu -->
        <div class="cleaner"></div>
    </div> <!-- end of header -->
    
     <div id="middle">
     <!-- Start Top -->
		<div id="maindiv" style="width: 800px;">
    </div>
    <div class="code prettyprint">
        <pre class="code prettyprint brush: js"></pre>
        <style type="text/css">
            .note
            {
                font-size: 0.8em;
            }
            .jqplot-yaxis-tick
            {
                white-space: nowrap;
            }
        </style>
    <!-- End Top -->
    <div class="cleaner"></div>
	</div> <!-- end of middle -->
    
    <!-- end of main -->
</div> <!-- wrapper -->

<div id="footer_wrapper">
	<div id="footer"></div>
</div>
</div>
    
        <script class="code" type="text/javascript">
            var data = localStorage.getItem("twocubeSSO") || 0;
            $.urlParam = function (name) {
                var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
                return results[1] || 0;
            }
            $.getJSON("./Services/SurveyResults.asmx/getSurvey",
          {
              id: $.urlParam('id'),
              userhash: data
          },
          function (data) {
              $("<center><h2>" + data.surveyTitle + "</h2></center>").appendTo("#maindiv");
              $("<h4>" + data.surveyDescription + "</h4>").appendTo("#maindiv");
              $("<h4>" + data.noOfRespondents + " people responded</h4>").appendTo("#maindiv");
              $("<h4>" + data.avgTime + "seconds was the avg time</h4>").appendTo("#maindiv");
              $.each(data.questionList, function (question, questionList) {
                  // $("<h2>" + questionList.questionTitle + "</h2>").appendTo("#maindiv");

                  if(questionList.questionType == 2 || questionList.questionType == 3 || questionList.questionType == 4)
                  {
                      $("<div id=\"list" + question + "\"></div>").appendTo("#maindiv"); 
                      
                      $("<h3><font face=\"times new roman\" color=\"grey\">" + (question + 1) + ". " + questionList.questionTitle + questionList.questionType + "</font></h3>").appendTo("#list"+question);
                      $.each(questionList.optionList, function (option, optionList) {
                              $("<table border=\"1\" width=\"600px\"><tr><td><h4>" + optionList.noOfRespondents + " responded: " + optionList.responseStr + "</h4></td></tr></table>").appendTo("#list"+question);
                          });
                  }

                  else if (questionList.questionType == 0 || questionList.questionType == 5) { //radio button, scale radio

                      $("<div id=\"chartPie" + question + "\" style=\"height:350px; width:600px;\"></div>").appendTo("#maindiv");
                      $(function () {
                          var stuff = [];
                          $.each(questionList.optionList, function (option, optionList) {
                              var stuffItem = [];
                              stuffItem.push(optionList.optionTitle);
                              stuffItem.push(parseInt(optionList.noOfRespondents));
                              //stuffItem[optionList.optionTitle] = parseInt(optionList.noOfRespondents);
                              stuff.push(stuffItem);

                          });

                          var total = 0;
                          $(stuff).map(function () { total += this[1]; })

                          myLabels = $.makeArray($(stuff).map(function () { return this[1] + " " + Math.round(this[1] / total * 100) + "%"; }));
                          var plot1 = jQuery.jqplot('chartPie' + question, [stuff],

                      {
                          title: question + 1 + ". " + questionList.questionTitle + questionList.questionType,
                          seriesDefaults: {
                              // Make this a pie chart.
                              renderer: jQuery.jqplot.PieRenderer,
                              rendererOptions: {
                                  fill: true,
                                  shadowOffset: 2,
                                  shadowDepth: 5,
                                  sliceMargin: 2,
                                  dataLabels: myLabels,
                                  dataLabelThreshold: 0,
                                  dataLabelNudge: 20,
                                  // Put data labels on the pie slices.
                                  // By default, labels show the percentage of the slice.
                                  showDataLabels: true
                              }
                          },
                          legend: { show: true, location: 'e' }
                      });

                      })
                  }

                  else if (questionList.questionType == 1) { //checkbox
                      $("<div id=\"barChart" + question + "\" style=\"height:370px; width:600px;\"></div>").appendTo("#maindiv");
                      $(function () {
                          var stuff = [];
                          var labelX = [];
                          $.each(questionList.optionList, function (option, optionList) {
                              var stuffItem = [];
                              stuffItem.push(optionList.optionTitle);
                              stuffItem.push(parseInt(optionList.noOfRespondents));
                              //stuff.push(stuffItem);
                              stuff.push(optionList.noOfRespondents);
                              labelX.push(optionList.optionTitle);

                          });

                          var total = 0;
                          $(stuff).map(function () { total += this[1]; })

                          myLabels = $.makeArray($(stuff).map(function () { return this[1] + " " + Math.round(this[1] / total * 100) + "%"; }));
                          
                          
                          var plot3 = jQuery.jqplot('barChart' + question, [stuff],
                          
                          {

                              title: question + 1 + ". " + questionList.questionTitle + questionList.questionType,
                              seriesDefaults: {
                                  // Make this a bar chart.
                                  renderer: jQuery.jqplot.BarRenderer,
                                  rendererOptions: {
                                      barPadding: 1,
                                      barMargin: 15,
                                      barDirection: 'vertical',
                                      barWidth: 50
                                  },
                                  pointLables: { show: true }
                              },
                              axes: {
                                  xaxis: {
                                      renderer: jQuery.jqplot.CategoryAxisRenderer,
                                      ticks: labelX,
                                  },
                                  yaxis: {
                                      //label: "Y axis"
                                  }
                              },
                              legend: { show: false, location: 'e' }
                          });

                      })
                  }
                  else if (questionList.questionType == 3) {

                  }

              });



          });

        </script>
</body>
</html>
