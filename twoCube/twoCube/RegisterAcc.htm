<html>
<head>
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css"
        rel="stylesheet" type="text/css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
    <script src="https://raw.github.com/SamWM/jQuery-Plugins/master/numeric/jquery.numeric.js"></script>
    <script src="https://raw.github.com/maxatwork/form2js/master/src/form2js.js"></script>
    <script src="Scripts/json2.js"></script>
    <!-- 
	Copyright 2009 Itamar Arjuan
	jsDatePick is distributed under the terms of the GNU General Public License.
-->
    <link rel="stylesheet" type="text/css" media="all" href="jsDatePick_ltr.min.css" />
    <script type="text/javascript" src="jsDatePick.min.1.3.js"></script>
    <script type="text/javascript">
        window.onload = function () {
            new JsDatePick({
                useMode: 2,
                target: "inputField",
                dateFormat: "%d-%M-%Y"
            });
        };
    </script>
    <style type="text/css">
        #inputField
        {
            width: 128px;
        }
        #Text5
        {
            margin-top: 0px;
        }
        .style1
        {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <form id="testForm" method="post" onsubmit="return validateForm()" action="javascript:test()">
    <div>
        <table>
            <tr>
                <td class="style1">
                    <strong>Personal Information:</strong>
                </td>
                <td>
                    &nbsp;
                </td>
                <td>
                    &nbsp;
                </td>
                <td>
                    &nbsp;
                </td>
            </tr>
            <tr>
                <td>
                    First Name:
                </td>
                <td>
                    <input id="Text1" type="text" name="firstName" onchange="this.value = this.value.replace(/^\s+|\s+$/g, ''); valid_name.checked = this.value;" />
                    <input type="checkbox" disabled="disabled" name="valid_name" />
                </td>
                <td>
                    Last Name:
                </td>
                <td>
                    <input id="Text2" type="text" name="lastName" onchange="this.value = this.value.replace(/^\s+|\s+$/g, ''); valid_name2.checked = this.value;" />
                    <input type="checkbox" disabled="disabled" name="valid_name2" />
                </td>
            </tr>
            <tr>
                <td>
                    User Name (For Login):
                </td>
                <td>
                    <input id="Text4" type="text" name="userName" onchange="this.value = this.value.replace(/^\s+|\s+$/g, ''); valid_name3.checked = this.value;" />
                    <input type="checkbox" disabled="disabled" name="valid_name3" />
                </td>
                <td>
                    Email:
                </td>
                <td>
                    <input id="Text6" type="text" name="email" onchange="this.value = this.value.replace(/^\s+|\s+$/g, ''); valid_name4.checked = this.value;" />
                    <input type="checkbox" disabled="disabled" name="valid_name4" />
                </td>
            </tr>
            <tr>
                <td>
                    Date Of Birth:
                </td>
                <td>
                    <input type="text" id="inputField" name="dobCal" readonly="readonly" />
                </td>
                <td>
                    &nbsp;
                </td>
                <td>
                    &nbsp;
                </td>
            </tr>
            <tr>
                <td class="style1">
                    <strong>Account Information:</strong>
                </td>
                <td>
                    &nbsp;
                </td>
                <td>
                    &nbsp;
                </td>
                <td>
                </td>
            </tr>
            <tr>
                <td>
                    Password:
                </td>
                <td>
                    <input id="Password2" type="password" name="password" onchange="this.value = this.value.replace(/^\s+|\s+$/g, ''); valid_name7.checked = this.value;" />
                    <input type="checkbox" disabled="disabled" name="valid_name7" />
                </td>
                <td>
                    Confirm Password:
                </td>
                <td>
                    <input id="Password1" type="password" name="cpassword" onchange="this.value = this.value.replace(/^\s+|\s+$/g, ''); valid_name8.checked = this.value;" />
                    <input type="checkbox" disabled="disabled" name="valid_name8" />
                </td>
            </tr>
            <tr>
                <td>
                    &nbsp;
                </td>
                <td>
                    &nbsp;
                </td>
                <td>
                    &nbsp;
                </td>
                <td>
                    &nbsp;
                    <input type="submit" value="Create Account!" />
                </td>
            </tr>
        </table>
    </div>
    </form>
    <pre><code id="testArea"></code></pre>
    <script>
        $.fn.serializeObject = function () {
            var o = {};
            var a = this.serializeArray();
            $.each(a, function () {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        };

        function test() { //returned null if not found. returned user info when it is in db //test = function
            var formData = form2js('testForm', '.', true,
				function (node) {
				    if (node.id && node.id.match(/callbackTest/)) {
				        return { name: node.id, value: node.innerHTML };
				    }
				});

            document.getElementById('testArea').innerHTML = JSON.stringify(formData, null, '\t'); //formData = object
            $.post("./Services/MemberControllerService.asmx/listOfUsers",
          {
              jsonString: JSON.stringify(formData, null, '\t')
          },
            function (data) { //print out null or record found //data = undefined
                console.log(data);
                var json = $.parseJSON(data);
                if (parseInt(data.userExists) == 0) {
                    emailCheck();
                    data.userExists == 1;
                } else {
                    alert('Username has already been taken. Please try again.');
                }
            }, "json");

        }

        function emailCheck() { //returned null if not found. returned user info when it is in db //test = function
            var formData = form2js('testForm', '.', true,
				function (node) {
				    if (node.id && node.id.match(/callbackTest/)) {
				        return { name: node.id, value: node.innerHTML };
				    }
				});

            document.getElementById('testArea').innerHTML = JSON.stringify(formData, null, '\t'); //formData = object
            $.post("./Services/MemberControllerService.asmx/checkEmailExist",
          {
              jsonString: JSON.stringify(formData, null, '\t')
          },
            function (data) { //print out null or record found //data = undefined
                console.log(data);
                var json = $.parseJSON(data);
                if (parseInt(data.emailExists) == 0) {
                    test1();
                    data.emailExists == 1;
                } else {
                    alert('Email address has already been used. Please try again.');
                }
            }, "json");

        }

        function test1() { //add user successfully
            var formData = form2js('testForm', '.', true,
				function (node) {
				    if (node.id && node.id.match(/callbackTest/)) {
				        return { name: node.id, value: node.innerHTML };
				    }
				});

            document.getElementById('testArea').innerHTML = JSON.stringify(formData, null, '\t');
            $.post("./Services/MemberControllerService.asmx/AddUser",
          {
              jsonString: JSON.stringify(formData, null, '\t')
          },
            function (data) {
                console.log(data);
                var json = $.parseJSON(data);
            }, "json");
            alert('Congratulations! Account created! Please login now!');
        }

        function validateForm() {
            var firstName = document.forms["testForm"]["firstName"].value
            if (firstName == '' || firstName == null) {
                alert('Please enter your first name!');
                return false;
            }
            var lastName = document.forms["testForm"]["lastName"].value
            if (lastName == '' || lastName == null) {
                alert('Please enter your last name!');
                return false;
            }
            var userName = document.forms["testForm"]["userName"].value
            if (userName == '' || userName == null) {
                alert('Please enter your user name!');
                return false;
            }
            var email = document.forms["testForm"]["email"].value
            var reg = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
            if (reg.test(email) == false || email == '' || email == null) {
                alert('Please enter a valid email address!');
                return false;
            }
            var dobCal = document.forms["testForm"]["dobCal"].value
            if (dobCal == '' || dobCal == null) {
                alert('Please enter your date of birth!');
                return false;
            }
            var password = document.forms["testForm"]["password"].value
            if (password == '' || password == null) {
                alert('Please enter your password!');
                return false;
            }
            var cpassword = document.forms["testForm"]["cpassword"].value
            if (cpassword == '' || cpassword == null) {
                alert('Please confirm your password!');
                return false;
            }
            if (cpassword != password) {
                alert('password dont match!');
                return false;
            }
        }


    </script>
    <!-- 
    Email invalid when...
    mysite.ourearth.com [@ is not present]
    my@own@site@.org [only one @ is allowed]
    @you.me.net [No character before @]
    ourearth@ [No character after @]-->
</body>
</html>
