<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>twoCube - Analytics</title>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <link rel="stylesheet" href="http://www.jacklmoore.com/colorbox/example1/colorbox.css" /> 
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.jacklmoore.com/colorbox/colorbox/jquery.colorbox.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
    <script language="javascript" type="text/javascript" src="Scripts/jquery.jqplot.min.js"></script>
    <script type="text/javascript" src="Scripts/plugins/jqplot.pieRenderer.js"></script>
    <script type="text/javascript" src="Scripts/plugins/jqplot.barRenderer.js"></script>
    <script type="text/javascript" src="Scripts/plugins/jqplot.categoryAxisRenderer.js"></script>
    <script type="text/javascript" src="Scripts/plugins/jqplot.categoryAxisRenderer.js"></script>
    <script type="text/javascript" src="../src/plugins/jqplot.donutRenderer.min.js"></script>
    <link rel="Stylesheet" type="text/css" href="Styles/jquery.jqplot.min.css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="css/ddsmoothmenu.css" />
    <script type="text/javascript" src="js/scripts.js"></script>
    <!--<script type="text/javascript">
        google.load("jquery", "1.4.2");
        google.load("jqueryui", "1.7.2");
    </script>-->
</head>
<body onload="onload()">
    <div id="wrapper">
	<div id="header">
        <div id="site_title"><h1><a href="#"></a></h1></div>
       <!-- end of menu -->
        <div class="cleaner"></div>
    </div> <!-- end of header -->
    <div id="menu" class="ddsmoothmenu">
        </div> <br/>
     <!-- Start Top -->
		<div id="maindiv" align="center" style="width:100%;">
    </div>
    <div class="code prettyprint">
        <pre class="code prettyprint brush: js"></pre>
        <style type="text/css">
            .note
            {
                font-size: 0.8em;
            }
            .jqplot-yaxis-tick
            {
                white-space: nowrap;
            }
        </style>
    <!-- End Top -->
    <div class="cleaner"></div>
	</div> <!-- end of middle -->
    
    <!-- end of main -->
</div> <!-- wrapper -->

<div id="footer_wrapper">
	<div id="footer"></div>
</div>
</div>
    
        <script class="code" type="text/javascript">
            var data = localStorage.getItem("twocubeSSO") || 0;
            google.load('visualization', '1', {packages: ['geochart']});


            function drawVisualization() {
              var data = google.visualization.arrayToDataTable([
                ['Country', 'Respondents'],
                ['Germany', 1],
                ['United States', 8],
                ['Brazil', 1],
                ['Canada', 2],
                ['France', 2],
                ['RU', 1]
              ]);
    
              var geochart = new google.visualization.GeoChart(
                  document.getElementById('visualization'));
              geochart.draw(data, {width: 556, height: 347});
            }

            $.urlParam = function (name) {
                var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
                return results[1] || 0;
            }
            $.getJSON("./Services/SurveyResults.asmx/getSurvey",
          {
              id: $.urlParam('id'),
              memberHash: data
          },
          function (data) {
              $("<u><h1>" + data.surveyTitle + "</h1></u>").appendTo("#maindiv");
              if(data.surveyDescription!= null)
              {
                   $("<h4>" + data.surveyDescription + "</h4>").appendTo("#maindiv");
              }
              $("<h4> Number of Repondents: " + data.noOfRespondents + "</h4>").appendTo("#maindiv");
              $("<h4> Average time taken for " + data.noOfRespondents + " respondent(s) to do the survey: " + data.avgTime + " seconds </h4><br>").appendTo("#maindiv");
               
              $("<div id=\"visualization\"></div>").appendTo("#maindiv");
              $("<br>").appendTo("#maindiv");
              google.setOnLoadCallback(drawVisualization);
              $.each(data.questionList, function (question, questionList) {
                  // $("<h2>" + questionList.questionTitle + "</h2>").appendTo("#maindiv");
                  $("<br>").appendTo("#maindiv");
                  //date, numerical input, text, textarea
                  if(questionList.questionType == 2 || questionList.questionType == 3 || questionList.questionType == 4 || questionList.questionType == 6 || questionList.questionType == 7)
                  {
                      $("<div id=\"list" + question + "\"></div>").appendTo("#maindiv"); 
                      
                      $("<font size=\"3\" color=\"#585858\">" + (question + 1) + ". " + questionList.questionTitle + "</font><p>").appendTo("#list"+question);
                      
                      $.each(questionList.optionList, function (option, optionList) {
                               $("<div style=\"width:585px; border:1px solid grey;\"><font color=\"#585858\"><h5>" + ((optionList.noOfRespondents/data.noOfRespondents)*100).toFixed(1) + "% of the respondents responded: " + "<b>" + optionList.responseStr + "</b></font></h5></div>").appendTo("#list"+question);
                             //  $("<table cellpadding=\"8\" cellspacing=\"0\" border=\"1\" width=\"585px\"><tr><td><h5>" + optionList.noOfRespondents + " responded: " + optionList.responseStr + "</h5></td></tr></table>").appendTo("#list"+question);
                          });
                     
                  }

                  else if (questionList.questionType == 0 || questionList.questionType == 5) { //radio button, scale radio

                      $("<div id=\"chartPie" + question + "\" style=\"height:350px; width:600px;\"></div>").appendTo("#maindiv");
                      $(function () {
                          var stuff = [];
                          $.each(questionList.optionList, function (option, optionList) {
                              var stuffItem = [];
                              stuffItem.push(optionList.optionTitle);
                              stuffItem.push(parseInt(optionList.noOfRespondents));
                              //stuffItem[optionList.optionTitle] = parseInt(optionList.noOfRespondents);
                              stuff.push(stuffItem);

                          });

                          var total = 0;
                          $(stuff).map(function () { total += this[1]; })

                          myLabels = $.makeArray($(stuff).map(function () { return this[1] + " " + Math.round(this[1] / total * 100) + "%"; }));
                          var plot1 = jQuery.jqplot('chartPie' + question, [stuff],

                      {
                          title: question + 1 + ". " + questionList.questionTitle,
                          seriesDefaults: {
                              // Make this a pie chart.
                              renderer: jQuery.jqplot.PieRenderer,
                              rendererOptions: {
                                  fill: true,
                                  shadowOffset: 2,
                                  shadowDepth: 5,
                                  sliceMargin: 2,
                                  dataLabels: myLabels,
                                  dataLabelThreshold: 0,
                                  dataLabelNudge: 20,
                                  // Put data labels on the pie slices.
                                  // By default, labels show the percentage of the slice.
                                  showDataLabels: true
                              }
                          },
                          legend: { show: true, location: 'e' }
                      });

                      })
                  }

                  else if (questionList.questionType == 1) { //checkbox
                      $("<div id=\"barChart" + question + "\" style=\"height:370px; width:600px;\"></div>").appendTo("#maindiv");
                      $(function () {
                          var stuff = [];
                          var labelX = [];
                          $.each(questionList.optionList, function (option, optionList) {
                              var stuffItem = [];
                              stuffItem.push(optionList.optionTitle);
                              stuffItem.push(parseInt(optionList.noOfRespondents));
                              //stuff.push(stuffItem);
                              stuff.push(optionList.noOfRespondents);
                              labelX.push(optionList.optionTitle);

                          });

                          var total = 0;
                          $(stuff).map(function () { total += this[1]; })

                          myLabels = $.makeArray($(stuff).map(function () { return this[1] + " " + Math.round(this[1] / total * 100) + "%"; }));
                          
                          
                          var plot3 = jQuery.jqplot('barChart' + question, [stuff],
                          
                          {

                              title: question + 1 + ". " + questionList.questionTitle,
                              seriesDefaults: {
                                  // Make this a bar chart.
                                  renderer: jQuery.jqplot.BarRenderer,
                                  rendererOptions: {
                                      barPadding: 1,
                                      barMargin: 15,
                                      barDirection: 'vertical',
                                      barWidth: 50
                                  },
                                  pointLables: { show: true }
                              },
                              axes: {
                                  xaxis: {
                                      renderer: jQuery.jqplot.CategoryAxisRenderer,
                                      ticks: labelX,
                                  },
                                  yaxis: {
                                      //label: "Y axis"
                                  }
                              },
                              legend: { show: false, location: 'e' }
                          });

                      })
                  }

              });



          });


         

            
    

</script>
</body>
</html>
